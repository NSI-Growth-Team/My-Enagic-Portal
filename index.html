<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enagic Leader Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        /* Basic responsive adjustments if needed, Tailwind handles most */
        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transformation in browser (for simplicity, not for production) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Recharts CDN -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>

    <script type="text/babel">
        // Global variables for app ID and auth token (still used for user identification)
        const appId = 'default-app-id'; // This will be fixed for local HTML
        const initialAuthToken = null; // No initial auth token for local HTML

        // !!! IMPORTANT: REPLACE THIS PLACEHOLDER WITH YOUR DEPLOYED GOOGLE APPS SCRIPT WEB APP URL !!!
        // You get this URL after deploying your Google Apps Script as a web app.
        const GOOGLE_APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/a/macros/growithnsi.com/s/AKfycbxVQiZWIBb8TB_BOiwpqNRtZU-pSSzRQqLqXKm2IxuxmAesPRYyXSc6Er_GkiRpSk7H8A/exec'; // <--- THIS IS THE LINE YOU NEED TO EDIT

        // Create a context for User data and the Apps Script URL
        const AppContext = React.createContext(null);

        // App component - Main application container
        const App = () => {
            // We'll simulate authentication for the userEmail and isAdmin status
            // In a real scenario, you'd integrate a proper auth provider (e.g., Firebase Auth, Google Sign-In)
            const [userId, setUserId] = React.useState(null);
            const [userEmail, setUserEmail] = React.useState(null);
            const [isAdmin, setIsAdmin] = React.useState(false); // This will be determined by the Apps Script
            const [loading, setLoading] = React.useState(true);
            const [currentPage, setCurrentPage] = React.useState('dashboard'); // Default page
            const [appError, setAppError] = React.useState(null); // New state for app-level errors

            React.useEffect(() => {
                // Simulate user authentication for a local HTML file
                // For demonstration, we'll use a fixed user ID and email,
                // or a unique anonymous one if no specific user is simulated.
                // For now, let's use a random anonymous email to avoid conflicts if multiple people use the same local file.
                let currentUserEmail = `anonymous_${Math.random().toString(36).substring(2, 11)}@example.com`;
                let currentUserId = `anon_${crypto.randomUUID()}`;

                setUserId(currentUserId);
                setUserEmail(currentUserEmail);

                // Check admin status via Apps Script
                const checkAdminStatus = async () => {
                    if (GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        setAppError("Error: Google Apps Script URL is not configured. Please replace 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE' in the code.");
                        setLoading(false);
                        return;
                    }

                    try {
                        const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getUserDetails&userEmail=${currentUserEmail}`);
                        const result = await response.json();
                        if (result.success && result.data && result.data.IsAdmin === true) {
                            setIsAdmin(true);
                        } else {
                            setIsAdmin(false);
                        }
                    } catch (error) {
                        console.error("Error checking admin status:", error);
                        setAppError("Network error or issue connecting to Google Apps Script. Check console (F12) for details.");
                        setIsAdmin(false);
                    } finally {
                        setLoading(false);
                    }
                };

                checkAdminStatus();
            }, []); // Run once on mount

            if (loading) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-gray-100">
                        <div className="text-xl font-semibold text-gray-700">Loading application...</div>
                    </div>
                );
            }

            if (appError) {
                return (
                    <div className="flex items-center justify-center min-h-screen bg-red-100">
                        <div className="text-xl font-semibold text-red-700 p-4 rounded-lg shadow-md">
                            {appError}
                            <p className="mt-2 text-base text-red-600">Please ensure the Google Apps Script URL is correct and deployed as a web app with 'Anyone' access.</p>
                        </div>
                    </div>
                );
            }

            // Context value to be passed down to children
            const contextValue = { userId, userEmail, isAdmin, setCurrentPage, GOOGLE_APPS_SCRIPT_WEB_APP_URL };

            return (
                <AppContext.Provider value={contextValue}>
                    <div className="min-h-screen bg-gray-100 font-inter">
                        <Navbar currentPage={currentPage} setCurrentPage={setCurrentPage} />
                        <div className="container mx-auto p-4 sm:p-6 lg:p-8">
                            {currentPage === 'userDetailForm' && <UserDetailForm />}
                            {currentPage === 'dashboard' && <Dashboard />}
                            {currentPage === 'dailyTaskActivity' && <DailyTaskForm />}
                            {currentPage === 'enagicProcess' && <JourneyTrackerForm />}
                        </div>
                    </div>
                </AppContext.Provider>
            );
        };

        // Navbar component for navigation
        const Navbar = ({ currentPage, setCurrentPage }) => {
            const { userId, userEmail, isAdmin } = React.useContext(AppContext);
            const [dropdownOpen, setDropdownOpen] = React.useState(false);

            return (
                <nav className="bg-gradient-to-r from-blue-600 to-blue-800 p-4 shadow-lg rounded-b-lg">
                    <div className="container mx-auto flex justify-between items-center">
                        <h1 className="text-white text-2xl font-bold">Enagic Leader Portal</h1>
                        <div className="relative">
                            <button
                                onClick={() => setDropdownOpen(!dropdownOpen)}
                                className="bg-white text-blue-700 px-4 py-2 rounded-lg shadow-md hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-300 transition duration-200 ease-in-out flex items-center"
                            >
                                {currentPage === 'userDetailForm' && 'User Detail Form'}
                                {currentPage === 'dashboard' && 'Dashboard'}
                                {currentPage === 'dailyTaskActivity' && 'Daily Task Activity'}
                                {currentPage === 'enagicProcess' && 'Enagic Process'}
                                <svg
                                    className={`ml-2 w-4 h-4 transform ${dropdownOpen ? 'rotate-180' : 'rotate-0'} transition-transform duration-200`}
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            {dropdownOpen && (
                                <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl z-10">
                                    <a
                                        href="#"
                                        onClick={() => { setCurrentPage('userDetailForm'); setDropdownOpen(false); }}
                                        className="block px-4 py-3 text-gray-800 hover:bg-blue-100 rounded-t-lg transition duration-150 ease-in-out"
                                    >
                                        User Detail Form
                                    </a>
                                    <a
                                        href="#"
                                        onClick={() => { setCurrentPage('dashboard'); setDropdownOpen(false); }}
                                        className="block px-4 py-3 text-gray-800 hover:bg-blue-100 transition duration-150 ease-in-out"
                                    >
                                        Dashboard
                                    </a>
                                    <a
                                        href="#"
                                        onClick={() => { setCurrentPage('dailyTaskActivity'); setDropdownOpen(false); }}
                                        className="block px-4 py-3 text-gray-800 hover:bg-blue-100 transition duration-150 ease-in-out"
                                    >
                                        Daily Task Activity
                                    </a>
                                    <a
                                        href="#"
                                        onClick={() => { setCurrentPage('enagicProcess'); setDropdownOpen(false); }}
                                        className="block px-4 py-3 text-gray-800 hover:bg-blue-100 rounded-b-lg transition duration-150 ease-in-out"
                                    >
                                        Enagic Process
                                    </a>
                                </div>
                            )}
                        </div>
                        <div className="text-white text-sm sm:text-base">
                            User Email: <span className="font-semibold">{userEmail}</span>
                            {isAdmin && <span className="ml-2 px-2 py-1 bg-yellow-400 text-yellow-900 rounded-full text-xs font-bold">Admin</span>}
                        </div>
                    </div>
                </nav>
            );
        };

        // UserDetailForm component
        const UserDetailForm = () => {
            const { userEmail, GOOGLE_APPS_SCRIPT_WEB_APP_URL } = React.useContext(AppContext);
            const [userDetails, setUserDetails] = React.useState({
                Name: '',
                Email: userEmail || '',
                EnagicId: '',
                TargetIncome: '',
                City: '',
                PhoneNumber: '',
                IsAdmin: false, // This will be set by the backend, not directly by user
            });
            const [message, setMessage] = React.useState('');
            const [messageType, setMessageType] = React.useState(''); // 'success' or 'error'

            React.useEffect(() => {
                const fetchUserDetails = async () => {
                    if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        setMessage("Please configure the Google Apps Script URL in App.js.");
                        setMessageType('error');
                        return;
                    }

                    try {
                        const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getUserDetails&userEmail=${userEmail}`);
                        const result = await response.json();

                        if (result.success && result.data) {
                            setUserDetails(prev => ({
                                ...prev,
                                ...result.data,
                                Email: userEmail // Ensure email is always the authenticated email
                            }));
                        } else if (!result.success && result.message === 'User not found.') {
                            // User not found, pre-fill email and keep other fields empty
                            setUserDetails(prev => ({ ...prev, Email: userEmail }));
                        } else {
                            console.error("Error fetching user details:", result.message);
                            setMessage("Error loading user details: " + result.message);
                            setMessageType('error');
                        }
                    } catch (error) {
                        console.error("Network error fetching user details:", error);
                        setMessage("Network error loading user details.");
                        setMessageType('error');
                    }
                };

                fetchUserDetails();
            }, [userEmail, GOOGLE_APPS_SCRIPT_WEB_APP_URL]);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setUserDetails(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    setMessage("Please configure the Google Apps Script URL in App.js before saving.");
                    setMessageType('error');
                    return;
                }

                try {
                    const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=saveUserDetails&userEmail=${userEmail}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userDetails),
                    });
                    const result = await response.json();

                    if (result.success) {
                        setMessage("User details saved successfully!");
                        setMessageType('success');
                        setTimeout(() => setMessage(''), 3000); // Clear message after 3 seconds
                    } else {
                        console.error("Error saving user details:", result.message);
                        setMessage("Error saving user details: " + result.message);
                        setMessageType('error');
                    }
                } catch (error) {
                    console.error("Network error saving user details:", error);
                    setMessage("Network error saving user details.");
                    setMessageType('error');
                }
            };

            return (
                <div className="bg-white p-6 rounded-xl shadow-lg max-w-2xl mx-auto my-8">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">User Detail Form</h2>
                    {message && (
                        <div className={`p-3 mb-4 rounded-lg text-center ${messageType === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {message}
                        </div>
                    )}
                    <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="col-span-full">
                            <label htmlFor="Email" className="block text-gray-700 text-sm font-semibold mb-2">Email (Auto-filled)</label>
                            <input
                                type="email"
                                id="Email"
                                name="Email"
                                value={userDetails.Email}
                                readOnly
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="Name" className="block text-gray-700 text-sm font-semibold mb-2">Name</label>
                            <input
                                type="text"
                                id="Name"
                                name="Name"
                                value={userDetails.Name}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                                required
                            />
                        </div>
                        <div>
                            <label htmlFor="EnagicId" className="block text-gray-700 text-sm font-semibold mb-2">Enagic ID</label>
                            <input
                                type="text"
                                id="EnagicId"
                                name="EnagicId"
                                value={userDetails.EnagicId}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                                required
                            />
                        </div>
                        <div>
                            <label htmlFor="TargetIncome" className="block text-gray-700 text-sm font-semibold mb-2">Target Income (€)</label>
                            <input
                                type="number"
                                id="TargetIncome"
                                name="TargetIncome"
                                value={userDetails.TargetIncome}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                                required
                            />
                        </div>
                        <div>
                            <label htmlFor="City" className="block text-gray-700 text-sm font-semibold mb-2">City</label>
                            <input
                                type="text"
                                id="City"
                                name="City"
                                value={userDetails.City}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div className="col-span-full">
                            <label htmlFor="PhoneNumber" className="block text-gray-700 text-sm font-semibold mb-2">Phone Number</label>
                            <input
                                type="tel"
                                id="PhoneNumber"
                                name="PhoneNumber"
                                value={userDetails.PhoneNumber}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div className="col-span-full text-center">
                            <button
                                type="submit"
                                className="bg-blue-600 text-white px-8 py-3 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 ease-in-out text-lg font-semibold"
                            >
                                Save Details
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // DailyTaskForm component
        const DailyTaskForm = () => {
            const { userEmail, GOOGLE_APPS_SCRIPT_WEB_APP_URL } = React.useContext(AppContext);
            const [taskData, setTaskData] = React.useState({
                Date: new Date().toISOString().split('T')[0], // YYYY-MM-DD
                TaskType: 'Morning',
                Name: '',
                EnagicId: '',
                // TargetIncomePlannedActual removed from daily entry
                TotalDemosPlannedActual: '',
                CallsInUpline: '',
                MeetingsCount: '',
                FollowUpsDirect: '',
                FollowUpsIndirect: '',
                ClosingsDirect: '',
                ClosingsIndirect: '',
                Comments: ''
            });
            const [message, setMessage] = React.useState('');
            const [messageType, setMessageType] = React.useState('');

            React.useEffect(() => {
                // Fetch user's name and Enagic ID for pre-filling
                const fetchUserProfile = async () => {
                    if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        setMessage("Please configure the Google Apps Script URL in App.js.");
                        setMessageType('error');
                        return;
                    }
                    try {
                        const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getUserDetails&userEmail=${userEmail}`);
                        const result = await response.json();
                        if (result.success && result.data) {
                            const data = result.data;
                            setTaskData(prev => ({
                                ...prev,
                                Name: data.Name || '',
                                EnagicId: data.EnagicId || '',
                                // TargetIncomePlannedActual is no longer pre-filled here
                            }));
                        }
                    } catch (error) {
                        console.error("Error fetching user profile for daily task:", error);
                    }
                };
                fetchUserProfile();
            }, [userEmail, GOOGLE_APPS_SCRIPT_WEB_APP_URL]);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setTaskData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    setMessage("Please configure the Google Apps Script URL in App.js before saving.");
                    setMessageType('error');
                    return;
                }

                try {
                    const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=saveDailyActivity&userEmail=${userEmail}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(taskData),
                    });
                    const result = await response.json();

                    if (result.success) {
                        setMessage("Daily task activity saved successfully!");
                        setMessageType('success');
                        // Reset form fields after submission, excluding TargetIncomePlannedActual
                        setTaskData(prev => ({
                            ...prev,
                            TotalDemosPlannedActual: '',
                            CallsInUpline: '',
                            MeetingsCount: '',
                            FollowUpsDirect: '',
                            FollowUpsIndirect: '',
                            ClosingsDirect: '',
                            ClosingsIndirect: '',
                            Comments: ''
                        }));
                        setTimeout(() => setMessage(''), 3000);
                    } else {
                        console.error("Error saving daily task activity:", result.message);
                        setMessage("Error saving daily task activity: " + result.message);
                        setMessageType('error');
                    }
                } catch (error) {
                    console.error("Network error saving daily task activity:", error);
                    setMessage("Network error saving daily task activity.");
                    setMessageType('error');
                }
            };

            return (
                <div className="bg-white p-6 rounded-xl shadow-lg max-w-3xl mx-auto my-8">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">Daily Task Activity</h2>
                    {message && (
                        <div className={`p-3 mb-4 rounded-lg text-center ${messageType === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {message}
                        </div>
                    )}
                    <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label htmlFor="Date" className="block text-gray-700 text-sm font-semibold mb-2">Date</label>
                            <input
                                type="date"
                                id="Date"
                                name="Date"
                                value={taskData.Date}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400"
                                required
                            />
                        </div>
                        <div>
                            <label htmlFor="TaskType" className="block text-gray-700 text-sm font-semibold mb-2">Task Type</label>
                            <select
                                id="TaskType"
                                name="TaskType"
                                value={taskData.TaskType}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                                required
                            >
                                <option value="Morning">Morning Plan</option>
                                <option value="Evening">Evening Actual</option>
                            </select>
                        </div>
                        <div className="col-span-full">
                            <label htmlFor="Email" className="block text-gray-700 text-sm font-semibold mb-2">Email (Auto-filled)</label>
                            <input
                                type="email"
                                id="Email"
                                name="Email"
                                value={userEmail}
                                readOnly
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
                            />
                        </div>
                        <div>
                            <label htmlFor="Name" className="block text-gray-700 text-sm font-semibold mb-2">Name (Auto-filled)</label>
                            <input
                                type="text"
                                id="Name"
                                name="Name"
                                value={taskData.Name}
                                readOnly
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
                            />
                        </div>
                        <div>
                            <label htmlFor="EnagicId" className="block text-gray-700 text-sm font-semibold mb-2">Enagic ID (Auto-filled)</label>
                            <input
                                type="text"
                                id="EnagicId"
                                name="EnagicId"
                                value={taskData.EnagicId}
                                readOnly
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"
                            />
                        </div>
                        {/* Removed TargetIncomePlannedActual from here */}
                        <div>
                            <label htmlFor="TotalDemosPlannedActual" className="block text-gray-700 text-sm font-semibold mb-2">Total Demos (Planned/Actual)</label>
                            <input
                                type="number"
                                id="TotalDemosPlannedActual"
                                name="TotalDemosPlannedActual"
                                value={taskData.TotalDemosPlannedActual}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="CallsInUpline" className="block text-gray-700 text-sm font-semibold mb-2">Calls in Upline</label>
                            <input
                                type="number"
                                id="CallsInUpline"
                                name="CallsInUpline"
                                value={taskData.CallsInUpline}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="MeetingsCount" className="block text-gray-700 text-sm font-semibold mb-2">Meetings Count</label>
                            <input
                                type="number"
                                id="MeetingsCount"
                                name="MeetingsCount"
                                value={taskData.MeetingsCount}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="FollowUpsDirect" className="block text-gray-700 text-sm font-semibold mb-2">Follow-ups - Direct</label>
                            <input
                                type="number"
                                id="FollowUpsDirect"
                                name="FollowUpsDirect"
                                value={taskData.FollowUpsDirect}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="FollowUpsIndirect" className="block text-gray-700 text-sm font-semibold mb-2">Follow-ups - Indirect</label>
                            <input
                                type="number"
                                id="FollowUpsIndirect"
                                name="FollowUpsIndirect"
                                value={taskData.FollowUpsIndirect}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="ClosingsDirect" className="block text-gray-700 text-sm font-semibold mb-2">Closings - Direct</label>
                            <input
                                type="number"
                                id="ClosingsDirect"
                                name="ClosingsDirect"
                                value={taskData.ClosingsDirect}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="ClosingsIndirect" className="block text-gray-700 text-sm font-semibold mb-2">Closings - Indirect</label>
                            <input
                                type="number"
                                id="ClosingsIndirect"
                                name="ClosingsIndirect"
                                value={taskData.ClosingsIndirect}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div className="col-span-full">
                            <label htmlFor="Comments" className="block text-gray-700 text-sm font-semibold mb-2">Comments</label>
                            <textarea
                                id="Comments"
                                name="Comments"
                                value={taskData.Comments}
                                onChange={handleChange}
                                rows="3"
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            ></textarea>
                        </div>
                        <div className="col-span-full text-center">
                            <button
                                type="submit"
                                className="bg-blue-600 text-white px-8 py-3 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 ease-in-out text-lg font-semibold"
                            >
                                Submit Daily Activity
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // JourneyTrackerForm component
        const JourneyTrackerForm = () => {
            const { userEmail, GOOGLE_APPS_SCRIPT_WEB_APP_URL } = React.useContext(AppContext);
            const [journeyStatus, setJourneyStatus] = React.useState({
                MachinePurchased: false,
                DistributorId: false,
                VisitingCard: false,
                StartDemos: false,
                ConnectedUpline: false,
                FirstISaleDone: false,
                DocsSubmitted: false,
                MachineDelivered: false,
            });
            const [message, setMessage] = React.useState('');
            const [messageType, setMessageType] = React.useState('');

            React.useEffect(() => {
                const fetchJourneyStatus = async () => {
                    if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        setMessage("Please configure the Google Apps Script URL in App.js.");
                        setMessageType('error');
                        return;
                    }
                    try {
                        const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getEnagicJourney&userEmail=${userEmail}`);
                        const result = await response.json();
                        if (result.success && result.data) {
                            setJourneyStatus(result.data);
                        } else {
                            console.error("Error fetching journey tracker data:", result.message);
                            setMessage("Error loading journey tracker data: " + result.message);
                            setMessageType('error');
                        }
                    } catch (error) {
                        console.error("Network error fetching journey tracker data:", error);
                        setMessage("Network error loading journey tracker data.");
                        setMessageType('error');
                    }
                };
                fetchJourneyStatus();
            }, [userEmail, GOOGLE_APPS_SCRIPT_WEB_APP_URL]);

            const handleChange = async (e) => {
                const { name, checked } = e.target;
                const updatedStatus = { ...journeyStatus, [name]: checked };
                setJourneyStatus(updatedStatus); // Optimistic update

                if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    setMessage("Please configure the Google Apps Script URL in App.js before saving.");
                    setMessageType('error');
                    return;
                }

                try {
                    const response = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=updateEnagicJourney&userEmail=${userEmail}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(updatedStatus),
                    });
                    const result = await response.json();

                    if (result.success) {
                        setMessage("Journey status updated!");
                        setMessageType('success');
                        setTimeout(() => setMessage(''), 2000);
                    } else {
                        console.error("Error updating journey status:", result.message);
                        setMessage("Error updating journey status: " + result.message);
                        setMessageType('error');
                        // Revert optimistic update on error
                        setJourneyStatus(journeyStatus);
                    }
                } catch (error) {
                    console.error("Network error updating journey status:", error);
                    setMessage("Network error updating journey status.");
                    setMessageType('error');
                    // Revert optimistic update on error
                    setJourneyStatus(journeyStatus);
                }
            };

            const journeySteps = [
                { label: "Machine Purchased", name: "MachinePurchased" },
                { label: "Distributor ID Obtained", name: "DistributorId" },
                { label: "Visiting Card Created", name: "VisitingCard" },
                { label: "Started Demos", name: "StartDemos" },
                { label: "Connected with Upline", name: "ConnectedUpline" },
                { label: "First I-Sale Done", name: "FirstISaleDone" },
                { label: "DocsSubmitted", name: "DocsSubmitted" },
                { label: "Machine Delivered", name: "MachineDelivered" },
            ];

            return (
                <div className="bg-white p-6 rounded-xl shadow-lg max-w-2xl mx-auto my-8">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">Enagic Process Tracker</h2>
                    {message && (
                        <div className={`p-3 mb-4 rounded-lg text-center ${messageType === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                            {message}
                        </div>
                    )}
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        {journeySteps.map((step) => (
                            <div key={step.name} className="flex items-center p-3 border border-gray-200 rounded-lg bg-gray-50 hover:bg-gray-100 transition duration-150 ease-in-out">
                                <input
                                    type="checkbox"
                                    id={step.name}
                                    name={step.name}
                                    checked={journeyStatus[step.name]}
                                    onChange={handleChange}
                                    className="h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                                />
                                <label htmlFor={step.name} className="ml-3 text-gray-700 font-medium cursor-pointer">
                                    {step.label}
                                </label>
                            </div>
                        ))}
                    </div>
                    <p className="text-sm text-gray-500 mt-6 text-center">
                        Your Enagic journey progress. Email: <span className="font-semibold">{userEmail}</span>
                    </p>
                </div>
            );
        };

        // Dashboard component
        const Dashboard = () => {
            const { userEmail, isAdmin, GOOGLE_APPS_SCRIPT_WEB_APP_URL } = React.useContext(AppContext);
            const [dailyData, setDailyData] = React.useState([]);
            const [userDetails, setUserDetails] = React.useState(null);
            const [allUsersDetails, setAllUsersDetails] = React.useState([]);
            const [selectedUserForAdminView, setSelectedUserForAdminView] = React.useState(null);
            const [dailyActivityNotification, setDailyActivityNotification] = React.useState(''); // New state for notification

            // Filter states
            const [startDate, setStartDate] = React.useState('');
            const [endDate, setEndDate] = React.useState('');
            const [selectedTaskType, setSelectedTaskType] = React.useState('All'); // 'All', 'Morning', 'Evening'

            React.useEffect(() => {
                const fetchData = async () => {
                    if (!userEmail || !GOOGLE_APPS_SCRIPT_WEB_APP_URL || GOOGLE_APPS_SCRIPT_WEB_APP_URL === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        console.error("Google Apps Script URL is not configured. Please replace 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE' with your deployed Apps Script URL.");
                        return;
                    }

                    // Fetch current user's details
                    try {
                        const userDetailsResponse = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getUserDetails&userEmail=${userEmail}`);
                        const userDetailsResult = await userDetailsResponse.json();
                        if (userDetailsResult.success && userDetailsResult.data) {
                            setUserDetails(userDetailsResult.data);
                        } else {
                            setUserDetails(null);
                        }
                    } catch (error) {
                        console.error("Error fetching user details for dashboard:", error);
                    }

                    // Determine which email to fetch activities for
                    let emailToFetchActivities = userEmail;
                    if (isAdmin && selectedUserForAdminView) {
                        // If admin and a user is selected, use that user's email (which is their userId in this setup)
                        emailToFetchActivities = selectedUserForAdminView;
                    }

                    // Fetch daily activities
                    try {
                        const dailyActivitiesResponse = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getDailyActivities&userEmail=${userEmail}&targetUserId=${emailToFetchActivities}`);
                        const dailyActivitiesResult = await dailyActivitiesResponse.json();
                        if (dailyActivitiesResult.success && dailyActivitiesResult.data) {
                            // Convert timestamp string to Date object for sorting
                            const data = dailyActivitiesResult.data.map(item => ({
                                ...item,
                                // Ensure Timestamp is a Date object for sorting. Fallback to Date if Date is missing/invalid.
                                Timestamp: item.Timestamp ? new Date(item.Timestamp) : (item.Date ? new Date(item.Date) : new Date())
                            }));
                            data.sort((a, b) => a.Timestamp - b.Timestamp);
                            setDailyData(data);

                            // --- Daily Activity Notification Logic for current user ---
                            if (!isAdmin || (isAdmin && selectedUserForAdminView === userEmail)) { // Only for the currently logged-in user
                                const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
                                const todayActivities = data.filter(activity => activity.Email === userEmail && activity.Date === today);

                                const hasMorning = todayActivities.some(activity => activity.TaskType === 'Morning');
                                const hasEvening = todayActivities.some(activity => activity.TaskType === 'Evening');

                                if (!hasMorning && !hasEvening) {
                                    setDailyActivityNotification("You haven't filled out your daily activity forms yet. Please fill out your Morning Plan and Evening Actual.");
                                } else if (!hasMorning) {
                                    setDailyActivityNotification("You haven't filled out your Morning Plan for today. Please do so!");
                                } else if (!hasEvening) {
                                    setDailyActivityNotification("You haven't filled out your Evening Actual for today. Please do so!");
                                } else {
                                    setDailyActivityNotification("Great job! You've completed both your Morning Plan and Evening Actual for today.");
                                }
                            } else {
                                setDailyActivityNotification(''); // Clear notification if admin viewing another user
                            }
                            // --- End Notification Logic ---

                        } else {
                            setDailyData([]);
                            if (!isAdmin || (isAdmin && selectedUserForAdminView === userEmail)) {
                                setDailyActivityNotification("No daily activities recorded yet. Please fill out your forms!");
                            } else {
                                setDailyActivityNotification('');
                            }
                        }
                    } catch (error) {
                        console.error("Error fetching daily activities:", error);
                        setDailyData([]);
                        if (!isAdmin || (isAdmin && selectedUserForAdminView === userEmail)) {
                            setDailyActivityNotification("Error loading daily activities. Please try again later.");
                        } else {
                            setDailyActivityNotification('');
                        }
                    }

                    // If admin, fetch all user details for dropdown
                    if (isAdmin) {
                        try {
                            const allUsersResponse = await fetch(`${GOOGLE_APPS_SCRIPT_WEB_APP_URL}?action=getAllUsersDetails&userEmail=${userEmail}`);
                            const allUsersResult = await allUsersResponse.json();
                            if (allUsersResult.success && allUsersResult.data) {
                                setAllUsersDetails(allUsersResult.data);
                                if (!selectedUserForAdminView && allUsersResult.data.length > 0) {
                                    setSelectedUserForAdminView(allUsersResult.data[0].Email); // Default to first user's email
                                }
                            } else {
                                setAllUsersDetails([]);
                            }
                        } catch (error) {
                            console.error("Error fetching all user details:", error);
                        }
                    }
                };

                fetchData();
                // Re-fetch when userEmail, isAdmin, or selectedUserForAdminView changes
            }, [userEmail, isAdmin, selectedUserForAdminView, GOOGLE_APPS_SCRIPT_WEB_APP_URL]);

            // Apply filters to dailyData
            const filteredDailyData = (isAdmin && selectedUserForAdminView
                ? dailyData.filter(item => item.Email === selectedUserForAdminView)
                : dailyData.filter(item => item.Email === userEmail) // Non-admin only sees their own data
            ).filter(item => {
                const itemDate = new Date(item.Date);
                const start = startDate ? new Date(startDate) : null;
                const end = endDate ? new Date(endDate) : null;

                const matchesDate = (!start || itemDate >= start) && (!end || itemDate <= end);
                const matchesTaskType = selectedTaskType === 'All' || item.TaskType === selectedTaskType;

                return matchesDate && matchesTaskType;
            });

            const displayedUserDetails = isAdmin && selectedUserForAdminView
                ? allUsersDetails.find(user => user.Email === selectedUserForAdminView) || userDetails
                : userDetails;

            // Prepare data for charts
            const chartData = filteredDailyData.map(item => ({
                date: item.Date,
                targetIncome: parseFloat(displayedUserDetails?.TargetIncome || 0), // Use the target from fetched user details
                // Actual income is no longer part of daily data
                meetingsCount: parseFloat(item.MeetingsCount || 0),
                demos: parseFloat(item.TotalDemosPlannedActual || 0),
                followUpsDirect: parseFloat(item.FollowUpsDirect || 0),
                followUpsIndirect: parseFloat(item.FollowUpsIndirect || 0),
                closingsDirect: parseFloat(item.ClosingsDirect || 0),
                closingsIndirect: parseFloat(item.ClosingsIndirect || 0)
            }));

            // Aggregate data for monthly bar chart
            const aggregatedData = chartData.reduce((acc, item) => {
                const month = item.date.substring(0, 7); // YYYY-MM
                if (!acc[month]) {
                    acc[month] = { month, totalMeetings: 0, totalDemos: 0,
                                   totalFollowUpsDirect: 0, totalFollowUpsIndirect: 0,
                                   totalClosingsDirect: 0, totalClosingsIndirect: 0 };
                }
                acc[month].totalMeetings += item.meetingsCount;
                acc[month].totalDemos += item.demos;
                // totalActualIncome removed from here
                acc[month].totalFollowUpsDirect += item.followUpsDirect;
                acc[month].totalFollowUpsIndirect += item.followUpsIndirect;
                acc[month].totalClosingsDirect += item.closingsDirect;
                acc[month].totalClosingsIndirect += item.closingsIndirect;
                return acc;
            }, {});
            const monthlyChartData = Object.values(aggregatedData).sort((a, b) => a.month.localeCompare(b.month));

            // Calculate active users for admin view
            const getActiveUsers = () => {
                const activeUsersMap = new Map();
                const twentyFourHoursAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);

                dailyData.forEach(item => {
                    if (item.Timestamp && new Date(item.Timestamp) >= twentyFourHoursAgo) {
                        activeUsersMap.set(item.Email, { name: item.Name, email: item.Email, lastActivity: new Date(item.Timestamp).toLocaleString() });
                    }
                });
                return Array.from(activeUsersMap.values());
            };

            const activeUsers = isAdmin ? getActiveUsers() : [];


            return (
                <div className="bg-white p-6 rounded-xl shadow-lg max-w-4xl mx-auto my-8">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">Dashboard</h2>

                    {dailyActivityNotification && (
                        <div className="p-4 mb-6 rounded-lg bg-blue-100 text-blue-700 text-center font-medium shadow-sm">
                            {dailyActivityNotification}
                        </div>
                    )}

                    {isAdmin && (
                        <div className="mb-6 p-4 border border-blue-200 rounded-lg bg-blue-50">
                            <h3 className="text-xl font-semibold text-blue-800 mb-3">Admin View Controls</h3>
                            <label htmlFor="userSelect" className="block text-blue-700 text-sm font-semibold mb-2">Select User:</label>
                            <select
                                id="userSelect"
                                value={selectedUserForAdminView || ''}
                                onChange={(e) => setSelectedUserForAdminView(e.target.value)}
                                className="w-full px-4 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                                {allUsersDetails.length === 0 && <option value="">No users available</option>}
                                {allUsersDetails.map(user => (
                                    <option key={user.Email} value={user.Email}>
                                        {user.Name} ({user.Email})
                                    </option>
                                ))}
                            </select>

                            <div className="mt-6">
                                <h4 className="text-lg font-semibold text-blue-800 mb-2">Active Users (Last 24h):</h4>
                                {activeUsers.length > 0 ? (
                                    <ul className="list-disc list-inside text-gray-700">
                                        {activeUsers.map(user => (
                                            <li key={user.email}>{user.name} ({user.email}) - Last Activity: {user.lastActivity}</li>
                                        ))}
                                    </ul>
                                ) : (
                                    <p className="text-gray-600">No active users in the last 24 hours.</p>
                                )}
                            </div>
                        </div>
                    )}

                    <div className="mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label htmlFor="startDate" className="block text-gray-700 text-sm font-semibold mb-2">Start Date:</label>
                            <input
                                type="date"
                                id="startDate"
                                value={startDate}
                                onChange={(e) => setStartDate(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="endDate" className="block text-gray-700 text-sm font-semibold mb-2">End Date:</label>
                            <input
                                type="date"
                                id="endDate"
                                value={endDate}
                                onChange={(e) => setEndDate(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            />
                        </div>
                        <div>
                            <label htmlFor="taskTypeFilter" className="block text-gray-700 text-sm font-semibold mb-2">Task Type:</label>
                            <select
                                id="taskTypeFilter"
                                value={selectedTaskType}
                                onChange={(e) => setSelectedTaskType(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                                <option value="All">All</option>
                                <option value="Morning">Morning Plan</option>
                                <option value="Evening">Evening Actual</option>
                            </select>
                        </div>
                    </div>

                    <div className="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
                        <h3 className="text-xl font-semibold text-gray-800 mb-3">Your Current Targets & Details</h3>
                        {displayedUserDetails ? (
                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700">
                                <p><strong>Name:</strong> {displayedUserDetails.Name}</p>
                                <p><strong>Email:</strong> {displayedUserDetails.Email}</p>
                                <p><strong>Enagic ID:</strong> {displayedUserDetails.EnagicId}</p>
                                <p><strong>Target Income:</strong> €{displayedUserDetails.TargetIncome}</p>
                                <p><strong>City:</strong> {displayedUserDetails.City}</p>
                                <p><strong>Phone:</strong> {displayedUserDetails.PhoneNumber}</p>
                                {/* Displaying user ID (email in this Sheets setup) */}
                                <p className="col-span-full"><strong>User Email (ID):</strong> {displayedUserDetails.Email}</p>
                            </div>
                        ) : (
                            <p className="text-gray-600">Please fill out your User Detail Form to see your targets.</p>
                        )}
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* Income Progress Chart */}
                        <div className="bg-blue-50 p-4 rounded-lg shadow-md">
                            <h3 className="text-lg font-semibold text-blue-800 mb-4 text-center">Income Progress (Daily)</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <LineChart data={chartData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                    <XAxis dataKey="date" />
                                    <YAxis />
                                    <Tooltip />
                                    <Legend />
                                    <Line type="monotone" dataKey="targetIncome" stroke="#8884d8" name="Target Income" />
                                    {/* Removed Actual Income Line */}
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Meetings and Demos Chart */}
                        <div className="bg-green-50 p-4 rounded-lg shadow-md">
                            <h3 className="text-lg font-semibold text-green-800 mb-4 text-center">Daily Meetings & Demos</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <BarChart data={chartData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                    <XAxis dataKey="date" />
                                    <YAxis />
                                    <Tooltip />
                                    <Legend />
                                    <Bar dataKey="meetingsCount" fill="#8884d8" name="Meetings" />
                                    <Bar dataKey="demos" fill="#82ca9d" name="Demos" />
                                </BarChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Follow-ups Chart */}
                        <div className="bg-purple-50 p-4 rounded-lg shadow-md">
                            <h3 className="text-lg font-semibold text-purple-800 mb-4 text-center">Daily Follow-ups</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <LineChart data={chartData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                    <XAxis dataKey="date" />
                                    <YAxis />
                                    <Tooltip />
                                    <Legend />
                                    <Line type="monotone" dataKey="followUpsDirect" stroke="#ff7300" name="Direct Follow-ups" />
                                    <Line type="monotone" dataKey="followUpsIndirect" stroke="#00c49f" name="Indirect Follow-ups" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Closings Chart */}
                        <div className="bg-red-50 p-4 rounded-lg shadow-md">
                            <h3 className="text-lg font-semibold text-red-800 mb-4 text-center">Daily Closings</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <LineChart data={chartData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                    <XAxis dataKey="date" />
                                    <YAxis />
                                    <Tooltip />
                                    <Legend />
                                    <Line type="monotone" dataKey="closingsDirect" stroke="#ff0000" name="Direct Closings" />
                                    <Line type="monotone" dataKey="closingsIndirect" stroke="#82ca9d" name="Indirect Closings" />
                                </LineChart>
                            </ResponsiveContainer>
                        </div>

                        {/* Monthly Aggregated Data */}
                        <div className="col-span-full bg-yellow-50 p-4 rounded-lg shadow-md">
                            <h3 className="text-lg font-semibold text-yellow-800 mb-4 text-center">Monthly Aggregated Performance</h3>
                            <ResponsiveContainer width="100%" height={300}>
                                <BarChart data={monthlyChartData} margin={{ top: 5, right: 20, left: 10, bottom: 5 }}>
                                    <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                    <XAxis dataKey="month" />
                                    <YAxis />
                                    <Tooltip />
                                    <Legend />
                                    <Bar dataKey="totalMeetings" fill="#ffc658" name="Total Meetings" />
                                    <Bar dataKey="totalDemos" fill="#a4de6c" name="Total Demos" />
                                    <Bar dataKey="totalFollowUpsDirect" fill="#ff7300" name="Total Direct F/U" />
                                    <Bar dataKey="totalFollowUpsIndirect" fill="#00c49f" name="Total Indirect F/U" />
                                    <Bar dataKey="totalClosingsDirect" fill="#ff0000" name="Total Direct Closings" />
                                    <Bar dataKey="totalClosingsIndirect" fill="#82ca9d" name="Total Indirect Closings" />
                                    {/* Removed Total Actual Income Bar */}
                                </BarChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    <div className="mt-8">
                        <h3 className="text-xl font-semibold text-gray-800 mb-4 text-center">Recent Daily Activities (Filtered)</h3>
                        {filteredDailyData.length > 0 ? (
                            <div className="overflow-x-auto rounded-lg shadow">
                                <table className="min-w-full bg-white border border-gray-200">
                                    <thead className="bg-gray-100">
                                        <tr>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Date</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Type</th>
                                            {/* Removed Income (P/A) column */}
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Demos (P/A)</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">F/U Direct</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">F/U Indirect</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Closings Direct</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Closings Indirect</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Meetings</th>
                                            <th className="py-3 px-4 text-left text-sm font-semibold text-gray-600">Comments</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredDailyData.slice(-10).reverse().map((item, index) => ( // Show last 10 entries
                                            <tr key={item.Timestamp + index} className="border-t border-gray-200 hover:bg-gray-50">
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.Date}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.TaskType}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.TotalDemosPlannedActual}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.FollowUpsDirect}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.FollowUpsIndirect}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.ClosingsDirect}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.ClosingsIndirect}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.MeetingsCount}</td>
                                                <td className="py-3 px-4 text-sm text-gray-700">{item.Comments}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <p className="text-gray-600 text-center">No daily activities recorded yet for the selected filters.</p>
                        )}
                    </div>
                </div>
            );
        };

        // Render the App component into the root div
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
